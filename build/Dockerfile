FROM golang:1.19.1

RUN mkdir /app

COPY . /app

WORKDIR /app/cmd/meter.notifications

ARG SMTP_USERNAME
ENV METER_READINGS_SMTP_USERNAME: $SMTP_USERNAME

ARG SMTP_PASSWORD
ENV METER_READINGS_SMTP_PASSWORD $SMTP_PASSWORD

ARG SMTP_HOST=smtp.gmail.com
ENV METER_READINGS_SMTP_HOST $SMTP_HOST

ARG SMTP_PORT=587
ENV METER_READINGS_SMTP_PORT $SMTP_PORT

ARG SMTP_FROM
ENV METER_READINGS_SMTP_FROM $SMTP_FROM

ARG RECIPIENTS
ENV METER_READINGS_RECIPIENTS $RECIPIENTS

ARG WEBSITE
ENV METER_READINGS_WEBSITE $WEBSITE

ARG SUBJECT=Meter Reading Due
ENV METER_READINGS_SUBJECT $SUBJECT

RUN go build -o meter.readings .

CMD [ "/app/cmd/meter.notifications/meter.notifications" ]
