FROM golang:1.19.1

RUN mkdir /app

COPY . /app

WORKDIR /app/cmd/meter.notifications

ARG SMTP_USERNAME
ENV METER_READINGS_NOTIFICATIONS_SMTP_USERNAME $SMTP_USERNAME

ARG SMTP_PASSWORD
ENV METER_READINGS_NOTIFICATIONS_SMTP_PASSWORD $SMTP_PASSWORD

ARG SMTP_HOST=smtp.gmail.com
ENV METER_READINGS_NOTIFICATIONS_SMTP_HOST $SMTP_HOST

ARG SMTP_PORT=587
ENV METER_READINGS_NOTIFICATIONS_SMTP_PORT $SMTP_PORT

ARG SMTP_FROM
ENV METER_READINGS_NOTIFICATIONS_SMTP_FROM $SMTP_FROM

ARG RECIPIENTS
ENV METER_READINGS_NOTIFICATIONS_RECIPIENTS $RECIPIENTS

ARG WEBSITE
ENV METER_READINGS_NOTIFICATIONS_WEBSITE $WEBSITE

ARG SUBJECT="Meter Reading Due"
ENV METER_READINGS_NOTIFICATIONS_SUBJECT $SUBJECT

ARG HTTP_PORT=80
ENV METER_READINGS_NOTIFICATIONS_HTTP_PORT $HTTP_PORT

ARG TELEGRAM_BOT_TOKEN
ENV METER_READINGS_NOTIFICATIONS_TELEGRAM_BOT_TOKEN $TELEGRAM_BOT_TOKEN

ARG DISABLE_EMAIL=true
ENV METER_READINGS_NOTIFICATIONS_DISABLE_EMAIL $DISABLE_EMAIL

ARG TELEGRAM_CHANNEL_ID
ENV METER_READINGS_NOTIFICATIONS_TELEGRAM_CHANNEL_ID $TELEGRAM_CHANNEL_ID

RUN go build -o meter.notifications .

CMD [ "/app/cmd/meter.notifications/meter.notifications" ]
